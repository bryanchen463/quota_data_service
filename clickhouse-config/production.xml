<?xml version="1.0"?>
<clickhouse>
    <!-- 日志配置 -->
    <logger>
        <level>warning</level>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <size>1000M</size>
        <count>10</count>
    </logger>

    <!-- 端口配置 -->
    <http_port>8123</http_port>
    <tcp_port>9000</tcp_port>
    <https_port>9009</https_port>
    <tcp_port_secure>9440</tcp_port_secure>

    <!-- 连接配置 -->
    <max_connections>4096</max_connections>
    <keep_alive_timeout>300</keep_alive_timeout>
    <max_concurrent_queries>1000</max_concurrent_queries>
    <uncompressed_cache_size>8589934592</uncompressed_cache_size>
    <mark_cache_size>5368709120</mark_cache_size>

    <!-- 路径配置 -->
    <path>/var/lib/clickhouse/</path>
    <tmp_path>/var/lib/clickhouse/tmp/</tmp_path>
    <user_files_path>/var/lib/clickhouse/user_files/</user_files_path>
    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>

    <!-- 用户配置 -->
    <users_config>users.xml</users_config>
    <default_profile>default</default_profile>
    <default_database>default</default_database>

    <!-- 时区配置 -->
    <timezone>UTC</timezone>

    <!-- 性能优化配置 -->
    <max_memory_usage>68719476736</max_memory_usage>
    <max_memory_usage_for_user>64424509440</max_memory_usage_for_user>
    <max_memory_usage_for_all_queries>68719476736</max_memory_usage_for_all_queries>
    
    <!-- 查询优化 -->
    <max_bytes_before_external_group_by>2147483648</max_bytes_before_external_group_by>
    <max_bytes_before_external_sort>2147483648</max_bytes_before_external_sort>
    <max_bytes_in_distinct>2147483648</max_bytes_in_distinct>
    <max_bytes_in_join>2147483648</max_bytes_in_join>
    <max_bytes_in_set>2147483648</max_bytes_in_set>
    
    <!-- 插入优化 -->
    <max_insert_block_size>1048576</max_insert_block_size>
    <min_insert_block_size_rows>1048576</min_insert_block_size_rows>
    <min_insert_block_size_bytes>268435456</min_insert_block_size_bytes>
    
    <!-- 后台任务配置 -->
    <background_pool_size>16</background_pool_size>
    <background_schedule_pool_size>16</background_schedule_pool_size>
    
    <!-- 合并配置 -->
    <merge_tree>
        <parts_to_delay_insert>300</parts_to_delay_insert>
        <parts_to_throw_insert>600</parts_to_throw_insert>
        <max_bytes_to_merge_at_max_space_in_pool>1000000000000</max_bytes_to_merge_at_max_space_in_pool>
        <max_bytes_to_merge_at_min_space_in_pool>100000000000</max_bytes_to_merge_at_min_space_in_pool>
    </merge_tree>

    <!-- 网络配置 -->
    <listen_host>::</listen_host>
    <listen_host>0.0.0.0</listen_host>
    
    <!-- HTTP 配置 -->
    <http_server_default_response>
        <![CDATA[<html><head><title>ClickHouse</title></head><body><h1>ClickHouse</h1></body></html>]]>
    </http_server_default_response>
    
    <!-- 查询日志 -->
    <query_log>
        <database>system</database>
        <table>query_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_log>
    
    <!-- 查询线程日志 -->
    <query_thread_log>
        <database>system</database>
        <table>query_thread_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_thread_log>
    
    <!-- 错误日志 -->
    <errorlog>
        <database>system</database>
        <table>error_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </errorlog>
    
    <!-- 文本日志 -->
    <text_log>
        <database>system</database>
        <table>text_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </text_log>
    
    <!-- 度量指标 -->
    <metric_log>
        <database>system</database>
        <table>metric_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </metric_log>
    
    <!-- 异步插入配置 -->
    <async_insert>1</async_insert>
    <wait_for_async_insert>1</wait_for_async_insert>
    
    <!-- 分布式表配置 -->
    <remote_servers>
        <!-- 集群配置（如需要） -->
    </remote_servers>
    
    <!-- 宏配置 -->
    <macros>
        <!-- 宏定义（如需要） -->
    </macros>
    
    <!-- 包含其他配置文件 -->
    <include_from>/etc/clickhouse-server/config.d/*.xml</include_from>
</clickhouse> 